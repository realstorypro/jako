#!/usr/bin/env ruby

require 'rubygems'
require 'bundler/setup'
require 'commander/import'

program :name, 'Jacko-cli'
program :version, '0.1.0'
program :description, 'Factory worker with attitude'

default_command :prompt

command :prompt do |c|
  c.syntax = 'jacko'
  c.description = 'jacko default prompt'
  c.action do

    welcome_message
    choose do |menu|
      menu.prompt = 'How can I help you?'
      menu.choice('Add new instance') do
        new_instance
      end
      menu.choice('Suspend existing instance') do
      end
      menu.choice('Release instance update') do
      end
      menu.choice('Release global update') do
      end
    end

  end
end

# responsible for build
def new_instance
  blueprints_path = root + '/clients/blueprints'
  template_path = root + '/clients/template'
  folders = Dir.entries(blueprints_path)

  # we're removing the non blueprint items from the folder array
  folders = folders - ['.','..','_common']

  divider
  url = ask('What is the site url?')
  divider

  # removing the www. and replacing dots with underscores
  folder_name = url.gsub('www.','').gsub('.','_')

  # check if the folder exists
  existing_folder = folders.select {|folder| folder == folder_name}

  unless existing_folder.empty?
    divider
    say 'Aborting Operation'
    say "folder: #{folder_name} already exists clients/blueprints"
    return
  end

  say "adding blueprint to: #{folder_name} under clients/blueprints"
  FileUtils.copy_entry template_path, "#{blueprints_path}/#{folder_name}"

end



private

def root
  File.expand_path '../..', __FILE__
end

def welcome_message
  divider
  puts '----------- JAKO - Factory Worker with Attitude ----------'
  divider
end

def divider
  puts '----------------------------------------------------------'
end

def root
  File.expand_path('../..',__FILE__)
end

